<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>The Olympia Ledger — Est. 1889</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Fonts + Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500&family=Merriweather:ital,wght@0,300;0,400;0,700;0,900;1,400&family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <style>
    :root{
      --paper: #f4f1ea;
      --ink: #1f2937;
      --spruce: #064e3b;
      --rust: #9a3412;
      --gold: #b45309;
    }
    
    /* VINTAGE PAPER TEXTURE - CSS PATTERN */
    body {
      background-color: var(--paper);
      background-image: 
        linear-gradient(90deg, rgba(0,0,0,0.03) 1px, transparent 1px),
        linear-gradient(rgba(0,0,0,0.03) 1px, transparent 1px);
      background-size: 20px 20px;
      color: var(--ink);
      font-family: 'Merriweather', serif;
    }

    /* TYPOGRAPHY OVERRIDES */
    h1, h2, h3, h4, h5, .serif { font-family: 'Merriweather', serif; }
    .sans { font-family: 'Inter', sans-serif; }
    .mono { font-family: 'Courier Prime', monospace; }

    /* LAYOUT */
    main { min-height: calc(100vh - 200px); }

    /* NEWSPAPER CARD STYLING */
    .ledger-card {
      background: #fdfbf7;
      border: 1px solid #d1d5db;
      border-bottom: 3px solid #000; /* Heavy bottom weight like lead type */
      padding: 1.5rem;
      position: relative;
    }
    .ledger-card::before {
      content: '';
      position: absolute;
      top: 2px; left: 2px; right: 2px; bottom: 2px;
      border: 1px solid #e5e7eb;
      pointer-events: none;
    }

    /* DOUBLE BORDER HEADER */
    .double-border-bottom {
      border-bottom: 4px double #1f2937;
    }

    /* NAVIGATION BUTTONS */
    .nav-btn {
      font-family: 'Courier Prime', monospace;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      font-size: 0.85rem;
      padding-bottom: 2px;
      border-bottom: 2px solid transparent;
      transition: all 0.2s;
    }
    .nav-btn:hover, .nav-btn.active {
      border-bottom-color: var(--rust);
      color: var(--rust);
      font-weight: bold;
    }

    /* TOGGLE SWITCH (Vintage Style) */
    .toggle-checkbox:checked {
      right: 0;
      border-color: var(--spruce);
    }
    .toggle-checkbox:checked + .toggle-label {
      background-color: var(--spruce);
    }
    
    /* CHART CONTAINER */
    .chart-wrap { position: relative; height: 300px; width: 100%; }

    /* CUSTOM SCROLLBAR */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #e5e7eb; }
    ::-webkit-scrollbar-thumb { background: #9ca3af; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #6b7280; }
  </style>
</head>
<body class="flex flex-col min-h-screen">

  <!-- HEADER / MASTHEAD -->
  <header class="bg-[#fdfbf7] border-b-4 border-double border-gray-800 sticky top-0 z-50 shadow-sm">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="py-4 flex flex-col md:flex-row items-center justify-between gap-4">
        
        <!-- LOGO -->
        <a href="#" onclick="APP.nav('home')" class="flex items-center gap-4 group">
          <div class="w-12 h-12 bg-gray-900 text-[#fdfbf7] flex items-center justify-center border-2 border-double border-gray-600 shadow-sm">
            <i class="fa-solid fa-scale-balanced text-2xl group-hover:scale-110 transition-transform"></i>
          </div>
          <div class="flex flex-col">
            <h1 class="text-3xl font-black tracking-tight leading-none">THE OLYMPIA LEDGER</h1>
            <div class="flex justify-between items-center w-full border-t border-gray-400 mt-1 pt-1">
              <span class="text-[0.65rem] font-bold uppercase tracking-[0.2em] text-gray-600 sans">Est. 1889</span>
              <span class="text-[0.65rem] font-bold uppercase tracking-[0.2em] text-emerald-800 sans">Vol. 134</span>
            </div>
          </div>
        </a>

        <!-- NAV -->
        <nav class="flex flex-wrap justify-center gap-6 md:gap-8" aria-label="Primary navigation">
          <button class="nav-btn active" data-target="home">Dispatch</button>
          <button class="nav-btn" data-target="budget">The Budget</button>
          <button class="nav-btn" data-target="bills">Legislation</button>
          <button class="nav-btn" data-target="tools">Calculators</button>
        </nav>

        <!-- MOBILE MENU BTN -->
        <button id="mobile-toggle" class="md:hidden absolute top-4 right-4 text-2xl"><i class="fa-solid fa-bars"></i></button>
      </div>
    </div>
  </header>

  <!-- MAIN CONTENT -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

    <!-- DASHBOARD (HOME) -->
    <section id="page-home" class="page">
      
      <!-- HERO: THE DEBT CLOCK -->
      <div class="ledger-card mb-8 border-t-4 border-t-emerald-900 bg-[#f0fdf4]">
        <div class="flex flex-col lg:flex-row items-center justify-between gap-8">
          <div class="text-center lg:text-left">
            <div class="text-xs font-bold uppercase tracking-widest text-emerald-800 mb-1 sans">Official State Registry</div>
            <h2 class="text-4xl lg:text-5xl font-black text-gray-900 mb-2">Fiscal Health Monitor</h2>
            <p class="text-gray-600 italic font-serif">"The public credit is the public's trust."</p>
          </div>
          
          <div class="bg-gray-900 p-6 border-4 border-double border-gray-600 shadow-xl w-full lg:w-auto min-w-[320px]">
            <div class="flex justify-between items-end mb-2 border-b border-gray-700 pb-2">
              <span class="text-gray-400 text-xs uppercase tracking-widest mono">Total State Debt</span>
              <span class="text-red-400 text-xs mono animate-pulse">● LIVE</span>
            </div>
            <div id="debt-clock" class="text-3xl md:text-5xl font-bold text-[#fdfbf7] mono tracking-tighter text-right">$0.00</div>
            <div class="text-right mt-2">
               <span id="per-capita-debt" class="text-emerald-400 text-sm mono font-bold">$0.00</span>
               <span class="text-gray-500 text-xs uppercase tracking-wide ml-1">Per Citizen</span>
            </div>
          </div>
        </div>
      </div>

      <!-- KEY INDICATORS -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
        <div class="ledger-card hover:shadow-lg transition-shadow cursor-pointer" onclick="APP.nav('budget')">
          <div class="text-xs text-gray-500 uppercase tracking-widest border-b border-gray-300 pb-1 mb-2 sans">Annual Revenue</div>
          <div class="text-3xl font-bold text-emerald-800 mono">$39.8B</div>
          <p class="text-sm text-gray-600 mt-2 font-serif italic">Tax collections FY24. Click to see source.</p>
        </div>
        
        <div class="ledger-card hover:shadow-lg transition-shadow cursor-pointer" onclick="APP.nav('budget')">
          <div class="text-xs text-gray-500 uppercase tracking-widest border-b border-gray-300 pb-1 mb-2 sans">Debt Service</div>
          <div class="text-3xl font-bold text-rust mono">$1.44B</div>
          <p class="text-sm text-gray-600 mt-2 font-serif italic">Annual interest & principal payments.</p>
        </div>

        <div class="ledger-card hover:shadow-lg transition-shadow bg-gray-50 cursor-pointer" onclick="APP.nav('bills')">
          <div class="text-xs text-gray-500 uppercase tracking-widest border-b border-gray-300 pb-1 mb-2 sans">Session Status</div>
          <div class="text-3xl font-bold text-gray-900 mono">Day 42</div>
          <p class="text-sm text-gray-600 mt-2 font-serif italic">12 Bills Passed. 482 Introduced.</p>
        </div>
      </div>

      <!-- FRONT PAGE NEWS (MOCK) -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <div class="lg:col-span-2">
          <div class="double-border-bottom mb-4 pb-2 flex justify-between items-end">
            <h3 class="text-2xl font-bold">Latest Dispatches</h3>
            <span class="text-xs text-gray-500 uppercase sans">Olympia, WA</span>
          </div>
          
          <article class="mb-8 group cursor-pointer" onclick="APP.nav('bills')">
            <h4 class="text-xl font-bold mb-2 group-hover:text-rust transition-colors">Legislature Debates Transportation Bond</h4>
            <div class="text-xs text-gray-500 mb-3 mono">FILED: NOV 23, 2025 • SB-9000</div>
            <p class="text-gray-700 leading-relaxed">
              A new proposal (SB-9000) seeks to raise $200M for ferry system repairs. Analysts predict a long-term fiscal impact of -0.8% on the general fund reserves. 
              <span class="text-emerald-800 font-bold text-sm ml-1 underline">Read Analysis &rarr;</span>
            </p>
          </article>
          
          <article class="mb-8 group cursor-pointer" onclick="APP.nav('tools')">
            <h4 class="text-xl font-bold mb-2 group-hover:text-rust transition-colors">How Much is Your County Contributing?</h4>
            <div class="text-xs text-gray-500 mb-3 mono">FEATURED TOOL</div>
            <p class="text-gray-700 leading-relaxed">
              New census data reveals shifting tax burdens across the Cascades. Use our updated calculator to see your local share of the state debt.
              <span class="text-emerald-800 font-bold text-sm ml-1 underline">Calculate Now &rarr;</span>
            </p>
          </article>
        </div>

        <!-- SIDEBAR -->
        <div class="lg:col-span-1">
          <div class="bg-[#e7e5e0] p-4 border border-gray-400">
            <h4 class="font-bold text-center border-b-2 border-gray-800 pb-2 mb-4 uppercase tracking-widest text-sm">Quick Search</h4>
            <div class="relative">
              <input type="text" id="global-search" placeholder="Bill # or Topic..." class="w-full p-2 border border-gray-400 font-mono text-sm bg-[#fdfbf7] focus:ring-2 focus:ring-emerald-800 focus:outline-none">
              <button onclick="APP.search()" class="absolute right-2 top-2 text-gray-500 hover:text-gray-900"><i class="fa-solid fa-search"></i></button>
            </div>
            <div id="search-results" class="mt-4 space-y-2 hidden">
              <!-- JS Populated -->
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- BUDGET PAGE -->
    <section id="page-budget" class="page hidden">
      <div class="flex flex-col md:flex-row justify-between items-end mb-6 border-b-4 border-double border-gray-800 pb-4">
        <div>
          <h2 class="text-3xl font-bold">The Public Purse</h2>
          <p class="text-gray-600 italic">Biennial Budget Analysis (2025-2027)</p>
        </div>
        <div class="flex items-center gap-2 mt-4 md:mt-0">
          <span class="text-xs font-bold uppercase text-gray-500 sans">View:</span>
          <button onclick="APP.toggleBudgetView('total')" class="px-3 py-1 bg-gray-800 text-white text-xs uppercase mono">Total $</button>
          <button onclick="APP.toggleBudgetView('percapita')" class="px-3 py-1 bg-gray-200 text-gray-800 border border-gray-400 text-xs uppercase mono hover:bg-gray-300">Per Capita</button>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- MAIN CHART -->
        <div class="lg:col-span-2 ledger-card">
          <h3 class="font-bold text-lg mb-4 text-center border-b border-gray-200 pb-2">Expenditure by Department</h3>
          <div class="chart-wrap">
            <canvas id="chart-budget"></canvas>
          </div>
        </div>

        <!-- DETAILS PANEL -->
        <div class="lg:col-span-1 space-y-4">
          <div class="ledger-card bg-emerald-50 border-emerald-200">
            <h4 class="font-bold text-emerald-900 text-sm uppercase tracking-widest mb-2">Selected Category</h4>
            <div id="budget-detail-name" class="text-2xl font-black mb-1">Total Budget</div>
            <div id="budget-detail-amount" class="text-3xl font-mono text-gray-900 mb-4">$113.5B</div>
            
            <div class="space-y-2 text-sm mono">
              <div class="flex justify-between border-b border-emerald-200 pb-1">
                <span>Wages:</span>
                <span id="budget-detail-wages" class="font-bold">$49.3B</span>
              </div>
              <div class="flex justify-between border-b border-emerald-200 pb-1">
                <span>Capital:</span>
                <span id="budget-detail-capital" class="font-bold">$14.0B</span>
              </div>
              <div class="flex justify-between">
                <span>Ops/Equip:</span>
                <span id="budget-detail-equip" class="font-bold">$4.0B</span>
              </div>
            </div>
          </div>
          <div class="text-xs text-gray-500 italic p-2">
            * Data sourced from mock projections based on 2024 legislative reports. Tap any chart segment to update details.
          </div>
        </div>
      </div>
    </section>

    <!-- BILLS PAGE -->
    <section id="page-bills" class="page hidden">
      <div class="mb-6 border-b-4 border-double border-gray-800 pb-4">
        <h2 class="text-3xl font-bold">Legislative Docket</h2>
        <p class="text-gray-600 italic">Tracking bills with significant fiscal impact.</p>
      </div>

      <div class="flex flex-col md:flex-row gap-6">
        <!-- FILTERS -->
        <div class="w-full md:w-1/4">
          <div class="ledger-card bg-gray-50">
            <h4 class="font-bold uppercase text-xs tracking-widest mb-4">Filter Docket</h4>
            <label class="block text-sm font-bold mb-2">Status</label>
            <select id="bill-filter" class="w-full p-2 border border-gray-400 font-mono text-sm mb-4 bg-white" onchange="APP.renderBills()">
              <option value="All">All Statuses</option>
              <option value="Enacted">Enacted (Law)</option>
              <option value="Passed Not Signed">Passed Leg.</option>
              <option value="Introduced">Introduced</option>
            </select>
            <div class="text-xs text-gray-500 italic">
              Showing <span id="bill-count" class="font-bold text-gray-900">0</span> records.
            </div>
          </div>
        </div>

        <!-- LIST -->
        <div class="w-full md:w-3/4">
          <div id="bills-list" class="space-y-4">
            <!-- Populated via JS -->
          </div>
        </div>
      </div>
    </section>

    <!-- TOOLS PAGE -->
    <section id="page-tools" class="page hidden">
      <div class="mb-6 border-b-4 border-double border-gray-800 pb-4">
        <h2 class="text-3xl font-bold">Citizen Calculators</h2>
        <p class="text-gray-600 italic">Personalize the data to your location.</p>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        
        <!-- COUNTY CALCULATOR -->
        <div class="ledger-card">
          <div class="border-b-2 border-gray-800 mb-4 pb-2 flex justify-between items-center">
            <h3 class="font-bold text-lg">Local Debt Share</h3>
            <i class="fa-solid fa-calculator text-gray-400"></i>
          </div>
          
          <p class="text-sm text-gray-700 mb-4 font-serif">
            The state debt is a collective obligation. Based on population, estimate your county's theoretical portion of the $143B liability.
          </p>

          <div class="mb-4">
            <label class="block text-xs font-bold uppercase mb-1">Select County</label>
            <select id="county-select" class="w-full p-2 border border-gray-400 font-mono bg-white">
              <option value="" disabled selected>-- Choose County --</option>
              <option value="King">King County</option>
              <option value="Pierce">Pierce County</option>
              <option value="Snohomish">Snohomish County</option>
              <option value="Spokane">Spokane County</option>
              <option value="Clark">Clark County</option>
              <option value="Thurston">Thurston County</option>
              <option value="Yakima">Yakima County</option>
            </select>
          </div>

          <button onclick="APP.calcCounty()" class="w-full py-3 bg-emerald-900 text-[#fdfbf7] font-bold uppercase tracking-widest text-xs hover:bg-emerald-800 transition">Calculate</button>

          <div id="county-result" class="mt-6 p-4 bg-gray-100 border border-gray-300 hidden">
            <div class="text-center">
              <div class="text-xs text-gray-500 uppercase">Total Share</div>
              <div id="county-share-val" class="text-2xl font-bold text-rust mono mb-1">$0</div>
              <div class="text-xs text-gray-500 uppercase">Per Resident</div>
              <div id="county-percap-val" class="text-lg font-bold text-gray-800 mono">$0</div>
            </div>
          </div>
        </div>

        <!-- TAX BREAKDOWN -->
        <div class="ledger-card">
           <div class="border-b-2 border-gray-800 mb-4 pb-2 flex justify-between items-center">
            <h3 class="font-bold text-lg">Tax Receipt Decoder</h3>
            <i class="fa-solid fa-receipt text-gray-400"></i>
          </div>
           <p class="text-sm text-gray-700 mb-4 font-serif">
            Enter a purchase amount to see how the 6.5% state sales tax is theoretically allocated based on the 2024 budget.
          </p>
          <div class="flex gap-2 mb-4">
             <span class="p-2 bg-gray-200 border border-gray-400 font-bold text-gray-600">$</span>
             <input type="number" id="purchase-amount" placeholder="e.g. 100.00" class="flex-1 p-2 border border-gray-400 font-mono">
          </div>
           <button onclick="APP.calcTax()" class="w-full py-3 bg-gray-800 text-[#fdfbf7] font-bold uppercase tracking-widest text-xs hover:bg-gray-700 transition">Break Down Receipt</button>
           
           <div id="receipt-result" class="mt-6 hidden">
             <div class="bg-white p-4 border border-dashed border-gray-400 shadow-sm font-mono text-xs">
                <div class="text-center font-bold mb-2">--- RECEIPT ---</div>
                <div class="flex justify-between mb-1"><span>PURCHASE:</span><span id="rec-total">$0.00</span></div>
                <div class="flex justify-between mb-2 border-b border-gray-300 pb-1"><span>STATE TAX (6.5%):</span><span id="rec-tax">$0.00</span></div>
                <div class="text-gray-500 mb-1">FUNDING ALLOCATION:</div>
                <div class="flex justify-between"><span>EDUCATION:</span><span id="rec-edu">$0.00</span></div>
                <div class="flex justify-between"><span>HUMAN SVCS:</span><span id="rec-hhs">$0.00</span></div>
                <div class="flex justify-between"><span>PUBLIC SAFETY:</span><span id="rec-safe">$0.00</span></div>
                <div class="flex justify-between"><span>OTHER:</span><span id="rec-other">$0.00</span></div>
                <div class="text-center font-bold mt-2">--- END ---</div>
             </div>
           </div>
        </div>

      </div>
    </section>

  </main>

  <!-- FOOTER -->
  <footer class="bg-gray-900 text-gray-400 py-12 mt-auto border-t-8 border-double border-emerald-900">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center md:text-left">
      <div class="flex flex-col md:flex-row justify-between items-center gap-6">
        <div>
          <h2 class="text-2xl font-black text-[#fdfbf7] sans tracking-widest">THE OLYMPIA LEDGER</h2>
          <p class="text-sm font-serif italic mt-2">"Independent analysis for the modern citizen."</p>
        </div>
        <div class="flex gap-6 text-sm mono">
          <a href="#" class="hover:text-white transition">ARCHIVES</a>
          <a href="#" class="hover:text-white transition">MASTHEAD</a>
          <a href="#" class="hover:text-white transition">CORRECTIONS</a>
        </div>
      </div>
      <div class="mt-8 pt-8 border-t border-gray-800 text-xs text-gray-600 flex justify-between items-center">
        <span>© 2025 The Olympia Ledger. Mock Data for Demonstration.</span>
        <span>Est. 1889</span>
      </div>
    </div>
  </footer>

  <!-- JAVASCRIPT LOGIC -->
  <script>
    /*******************************************************
     * DATA STORE (MOCK)
     *******************************************************/
    const DATA = {
      population: 7950000,
      
      // FIXED: Replaced static totalDebt with an Anchor Point
      // Anchor Date: Jan 1, 2024
      // Anchor Amount: $143 Billion (Estimate from 2024 reports)
      // Growth Rate: ~$7 Billion / Year (~$221.96 / Second)
      debtAnchor: {
        date: '2024-01-01T00:00:00', 
        amount: 143000000000, 
        rate: 221.96
      },
      
      budget: [
        { label: 'Education', value: 42000000000, wages: 22000000000, capital: 8000000000, equipment: 2000000000 },
        { label: 'Human Services', value: 31000000000, wages: 15000000000, capital: 3000000000, equipment: 1500000000 },
        { label: 'Transportation', value: 17000000000, wages: 3000000000, capital: 9000000000, equipment: 1000000000 },
        { label: 'Public Safety', value: 9000000000, wages: 6000000000, capital: 1000000000, equipment: 500000000 },
        { label: 'Gov Ops', value: 6500000000, wages: 3000000000, capital: 500000000, equipment: 200000000 },
        { label: 'Environment', value: 3000000000, wages: 1000000000, capital: 800000000, equipment: 100000000 },
        { label: 'Other', value: 5000000000, wages: 1800000000, capital: 800000000, equipment: 200000000 }
      ],

      bills: [
        { id: 'HB-1042', title: 'Housing Density Bonus', status: 'Enacted', impact: 12000000, desc: 'Increases density in urban zones.' },
        { id: 'SB-9000', title: 'Ferry Infrastructure Bond', status: 'Introduced', impact: -200000000, desc: 'Authorizes bonds for fleet repair.' },
        { id: 'HB-1110', title: 'Missing Middle Housing', status: 'Passed Not Signed', impact: 5000000, desc: 'Legalizes duplexes statewide.' },
        { id: 'SB-5599', title: 'Youth Services Funding', status: 'Enacted', impact: -45000000, desc: 'Expands shelter access.' },
        { id: 'HB-1240', title: 'Public Safety Regulation', status: 'Enacted', impact: -2000000, desc: 'Firearm restrictions.' }
      ],

      counties: {
        'King': 2300000,
        'Pierce': 950000,
        'Snohomish': 850000,
        'Spokane': 550000,
        'Clark': 520000,
        'Thurston': 300000,
        'Yakima': 260000
      }
    };

    /*******************************************************
     * APP LOGIC
     *******************************************************/
    const APP = {
      chartInstance: null,
      currentView: 'total', // 'total' or 'percapita'

      init() {
        this.bindNav();
        this.startDebtClock();
        this.renderBills();
        this.initBudgetChart();
      },

      // HELPER: Get Real-Time Debt
      getCurrentDebt() {
        const now = Date.now();
        const anchorTime = new Date(DATA.debtAnchor.date).getTime();
        const elapsedSeconds = (now - anchorTime) / 1000;
        return DATA.debtAnchor.amount + (elapsedSeconds * DATA.debtAnchor.rate);
      },

      // NAVIGATION
      bindNav() {
        const btns = document.querySelectorAll('.nav-btn');
        const mobileToggle = document.getElementById('mobile-toggle');
        
        btns.forEach(btn => {
          btn.addEventListener('click', (e) => this.nav(e.target.dataset.target));
        });

        // Simple Mobile Toggle
        if(mobileToggle) {
          mobileToggle.addEventListener('click', () => {
             const nav = document.querySelector('nav');
             nav.classList.toggle('hidden'); // Simplified for this demo
             nav.classList.toggle('flex');
             nav.classList.toggle('flex-col');
             nav.classList.toggle('absolute');
             nav.classList.toggle('top-16');
             nav.classList.toggle('left-0');
             nav.classList.toggle('bg-[#fdfbf7]');
             nav.classList.toggle('w-full');
             nav.classList.toggle('p-4');
             nav.classList.toggle('border-b');
             nav.classList.toggle('border-gray-800');
          });
        }
      },

      nav(targetId) {
        // Hide all pages
        document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
        // Show target
        document.getElementById(`page-${targetId}`).classList.remove('hidden');
        // Update Nav State
        document.querySelectorAll('.nav-btn').forEach(b => {
          b.classList.remove('active');
          if(b.dataset.target === targetId) b.classList.add('active');
        });
        window.scrollTo({ top: 0, behavior: 'smooth' });
      },

      // DEBT CLOCK
      startDebtClock() {
        const debtEl = document.getElementById('debt-clock');
        const perCapEl = document.getElementById('per-capita-debt');

        // Update continuously
        setInterval(() => {
          const currentVal = this.getCurrentDebt();
          
          debtEl.innerText = currentVal.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
          
          // Per Capita
          const perCap = currentVal / DATA.population;
          perCapEl.innerText = perCap.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
        }, 100); // 10 updates per second for smooth ticking
      },

      // BILLS LIST
      renderBills() {
        const filter = document.getElementById('bill-filter').value;
        const container = document.getElementById('bills-list');
        container.innerHTML = '';
        
        const filtered = DATA.bills.filter(b => filter === 'All' || b.status === filter);
        document.getElementById('bill-count').innerText = filtered.length;

        filtered.forEach(b => {
          const el = document.createElement('div');
          el.className = 'ledger-card hover:shadow-md transition-shadow flex justify-between items-start';
          el.innerHTML = `
            <div>
              <div class="flex items-center gap-2 mb-1">
                <span class="font-mono text-xs font-bold text-gray-500">${b.id}</span>
                <span class="px-2 py-0.5 bg-gray-200 text-gray-800 text-[0.6rem] uppercase tracking-wider font-bold rounded-sm">${b.status}</span>
              </div>
              <h4 class="font-bold text-lg text-gray-900">${b.title}</h4>
              <p class="text-sm text-gray-600 font-serif mt-1">${b.desc}</p>
            </div>
            <div class="text-right">
              <div class="text-xs text-gray-500 uppercase tracking-widest">Est. Impact</div>
              <div class="font-mono font-bold ${b.impact < 0 ? 'text-red-600' : 'text-emerald-700'}">
                ${b.impact < 0 ? '-' : '+'}${Math.abs(b.impact / 1000000).toFixed(1)}M
              </div>
            </div>
          `;
          container.appendChild(el);
        });
      },

      // SEARCH FUNCTION
      search() {
        const q = document.getElementById('global-search').value.toLowerCase();
        const resContainer = document.getElementById('search-results');
        if(q.length < 2) {
          resContainer.classList.add('hidden');
          return;
        }

        const hits = DATA.bills.filter(b => b.title.toLowerCase().includes(q) || b.id.toLowerCase().includes(q));
        
        resContainer.innerHTML = '';
        resContainer.classList.remove('hidden');
        
        if(hits.length === 0) {
          resContainer.innerHTML = '<div class="text-xs text-gray-500 italic p-2">No records found.</div>';
          return;
        }

        hits.forEach(b => {
           const div = document.createElement('div');
           div.className = 'p-2 bg-white border border-gray-300 text-sm hover:bg-gray-50 cursor-pointer';
           div.innerHTML = `<strong>${b.id}</strong>: ${b.title}`;
           div.onclick = () => { APP.nav('bills'); document.getElementById('global-search').value=''; resContainer.classList.add('hidden'); };
           resContainer.appendChild(div);
        });
      },

      // BUDGET CHART
      initBudgetChart() {
        const ctx = document.getElementById('chart-budget').getContext('2d');
        const colors = ['#064e3b', '#065f46', '#047857', '#059669', '#10b981', '#34d399', '#6ee7b7'];

        this.chartInstance = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: DATA.budget.map(d => d.label),
            datasets: [{
              label: 'Budget (Billions)',
              data: DATA.budget.map(d => d.value / 1000000000),
              backgroundColor: colors,
              borderWidth: 1,
              borderColor: '#022c22'
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false }
            },
            onClick: (e, elements) => {
              if (elements.length > 0) {
                const index = elements[0].index;
                this.updateBudgetDetail(index);
              }
            }
          }
        });
      },

      toggleBudgetView(mode) {
        this.currentView = mode;
        const pop = DATA.population;
        
        // Update Chart Data
        const newData = DATA.budget.map(d => {
           return mode === 'total' 
             ? d.value / 1000000000 
             : Math.round(d.value / pop);
        });
        
        this.chartInstance.data.datasets[0].data = newData;
        this.chartInstance.data.datasets[0].label = mode === 'total' ? 'Billions' : 'Dollars Per Citizen';
        this.chartInstance.update();

        // Update Text
        const btns = document.querySelectorAll('button[onclick^="APP.toggleBudgetView"]');
        btns[0].className = mode === 'total' ? 'px-3 py-1 bg-gray-800 text-white text-xs uppercase mono' : 'px-3 py-1 bg-gray-200 text-gray-800 border border-gray-400 text-xs uppercase mono hover:bg-gray-300';
        btns[1].className = mode === 'percapita' ? 'px-3 py-1 bg-gray-800 text-white text-xs uppercase mono' : 'px-3 py-1 bg-gray-200 text-gray-800 border border-gray-400 text-xs uppercase mono hover:bg-gray-300';
      },

      updateBudgetDetail(index) {
        const item = DATA.budget[index];
        const fmt = (n) => n.toLocaleString('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 1 }) + (n > 1000000000 ? 'B' : '');
        
        document.getElementById('budget-detail-name').innerText = item.label;
        document.getElementById('budget-detail-amount').innerText = fmt(item.value);
        document.getElementById('budget-detail-wages').innerText = fmt(item.wages);
        document.getElementById('budget-detail-capital').innerText = fmt(item.capital);
        document.getElementById('budget-detail-equip').innerText = fmt(item.equipment);
      },

      // CALCULATORS
      calcCounty() {
        const name = document.getElementById('county-select').value;
        if(!name) return;
        
        const pop = DATA.counties[name];
        const share = (pop / DATA.population);
        
        // FIXED: Use the real-time debt number for calculation
        const currentTotalDebt = this.getCurrentDebt();
        const debtShare = currentTotalDebt * share;
        const perCap = currentTotalDebt / DATA.population;

        document.getElementById('county-share-val').innerText = (debtShare / 1000000000).toFixed(2) + " Billion";
        document.getElementById('county-percap-val').innerText = perCap.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
        document.getElementById('county-result').classList.remove('hidden');
      },

      calcTax() {
        const val = parseFloat(document.getElementById('purchase-amount').value);
        if(!val) return;

        const tax = val * 0.065;
        const totalBudget = DATA.budget.reduce((a,b) => a + b.value, 0);
        
        // Ratios
        const rEdu = DATA.budget.find(d => d.label === 'Education').value / totalBudget;
        const rHHS = DATA.budget.find(d => d.label === 'Human Services').value / totalBudget;
        const rSafe = DATA.budget.find(d => d.label === 'Public Safety').value / totalBudget;
        
        document.getElementById('rec-total').innerText = val.toFixed(2);
        document.getElementById('rec-tax').innerText = tax.toFixed(2);
        
        document.getElementById('rec-edu').innerText = (tax * rEdu).toFixed(2);
        document.getElementById('rec-hhs').innerText = (tax * rHHS).toFixed(2);
        document.getElementById('rec-safe').innerText = (tax * rSafe).toFixed(2);
        document.getElementById('rec-other').innerText = (tax * (1 - rEdu - rHHS - rSafe)).toFixed(2);
        
        document.getElementById('receipt-result').classList.remove('hidden');
      }
    };

    // INIT
    APP.init();

  </script>
</body>
</html>